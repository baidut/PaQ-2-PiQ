<script>
function update_hist() {

    var hist_data = [
      {
        x: [].concat(...obj.normalized_local_scores.slice()),
        type: 'histogram',
    	  histnorm: 'probability',
    	  marker: {
            color: 'rgb(0,0,100)',
         },
      }
    ];

    var hist_layout = {
      height: 100,
      width: 400,
      autosize: true,
      margin: {
        l: 25,
        r: 25,
        b: 20,
        t: 0, // tooltip bar
        pad: 0
      },
    };

    // https://plot.ly/javascript/axes/
    if(!do_stretch){
      hist_layout['xaxis'] = {range: [0, 100]}
    }
    Plotly.newPlot('qualityHist', hist_data, hist_layout);
    // $('#btn_im_map').trigger('mouseenter');
    // $('#btn_im_map').trigger("click"); // mobile


    // alert(obj.global);
    // $('#score').text(obj.result);

    // score = Math.pow(obj.result/100, 2)*100;
    score = obj.normalized_global_score;
    $('#score').width(score+'%').attr('aria-valuenow', score+'%');
    // Predicted Quality Score: ' +
    $('#score').text(score);
    $('#h1_score').text(obj.category);
    // to do, support multiple files
   // https://plot.ly/javascript/colorscales/
   //$('#imtest').height()  document.querySelector('#imtest').height
   //
}

$(document).ready(function(){
  // $("#imgUploaded").hover(hide_image, show_image);
  // $('#heatmap').css('opacity', '0.8'); $('#imtest').css('opacity', '0.2')
  $('#check_contrast_stretch').change(update_qmap);
  update_hist();
  on_update_qmap(update_hist);
  // $('#check_contrast_stretch').prop( "checked", true );
});
</script>

<div class="doublecolumn advancedcfg">

  <div class="alert alert-light" role="alert">
    Local score histogram and global score

    <br/>
    <div align="center" id='qualityHist' style="width:100%; height: 80px"></div>
    <br/>

    <!-- credit:
    http://juliagraphics.github.io/Colors.jl/stable/colormaps/
    https://www.browserling.com/tools/reverse-lines -->
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="70%" height="4mm" viewBox="0 0 32 1" preserveAspectRatio="none" shape-rendering="crispEdges" stroke="none" style="width: 70%; height: 11.1667px;">
     <rect width="32" height="1" x=" 0" y="0" fill="#082C59"></rect>
     <rect width="31" height="1" x=" 1" y="0" fill="#143F77"></rect>
     <rect width="30" height="1" x=" 2" y="0" fill="#1F5392"></rect>
     <rect width="29" height="1" x=" 3" y="0" fill="#2B65A9"></rect>
     <rect width="28" height="1" x=" 4" y="0" fill="#3777BC"></rect>
     <rect width="27" height="1" x=" 5" y="0" fill="#4588CC"></rect>
     <rect width="26" height="1" x=" 6" y="0" fill="#5598D8"></rect>
     <rect width="25" height="1" x=" 7" y="0" fill="#65A7E1"></rect>
     <rect width="24" height="1" x=" 8" y="0" fill="#76B4E8"></rect>
     <rect width="23" height="1" x=" 9" y="0" fill="#87C0ED"></rect>
     <rect width="22" height="1" x="10" y="0" fill="#98CBF1"></rect>
     <rect width="21" height="1" x="11" y="0" fill="#A9D5F4"></rect>
     <rect width="20" height="1" x="12" y="0" fill="#B9DEF7"></rect>
     <rect width="19" height="1" x="13" y="0" fill="#C8E6F9"></rect>
     <rect width="18" height="1" x="14" y="0" fill="#D7EEFB"></rect>
     <rect width="17" height="1" x="15" y="0" fill="#E5F4FD"></rect>
     <rect width="16" height="1" x="16" y="0" fill="#FFECE7"></rect>
     <rect width="15" height="1" x="17" y="0" fill="#FFE2DA"></rect>
     <rect width="14" height="1" x="18" y="0" fill="#FFD6CC"></rect>
     <rect width="13" height="1" x="19" y="0" fill="#FFCABD"></rect>
     <rect width="12" height="1" x="20" y="0" fill="#FFBCAD"></rect>
     <rect width="11" height="1" x="21" y="0" fill="#FFAE9D"></rect>
     <rect width="10" height="1" x="22" y="0" fill="#FF9E8C"></rect>
     <rect width=" 9" height="1" x="23" y="0" fill="#FF8D7B"></rect>
     <rect width=" 8" height="1" x="24" y="0" fill="#FB7B6A"></rect>
     <rect width=" 7" height="1" x="25" y="0" fill="#F16858"></rect>
     <rect width=" 6" height="1" x="26" y="0" fill="#E35546"></rect>
     <rect width=" 5" height="1" x="27" y="0" fill="#D14136"></rect>
     <rect width=" 4" height="1" x="28" y="0" fill="#BB2E26"></rect>
     <rect width=" 3" height="1" x="29" y="0" fill="#A11C18"></rect>
     <rect width=" 2" height="1" x="30" y="0" fill="#820C0A"></rect>
     <rect width=" 1" height="1" x="31" y="0" fill="#610102"></rect>
    </svg>

    <div class="progress" style="display: inline-block; height: 20px; width: 70%" >
      <div id='score' class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
  <br/>
</div>
</div>
